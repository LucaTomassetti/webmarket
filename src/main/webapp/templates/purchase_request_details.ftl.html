<#include "/outline.ftl.html">

<div class="container mt-5">
    <h2>Dettagli Richiesta di Acquisto</h2>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Richiesta #${purchaseRequest.id}</h5>
            <p><strong>Categoria:</strong> ${purchaseRequest.getSubcategory().getCategory().getName()}</p>
            <p><strong>Sottocategoria:</strong> ${purchaseRequest.getSubcategory().getName()}</p>
            <p><strong>Stato:</strong> ${purchaseRequest.status}</p>
            <p><strong>Data Creazione:</strong> ${purchaseRequest.createdAt}</p>
            <p><strong>Priorità:</strong> ${purchaseRequest.isPriority()?string('Sì', 'No')}</p>

            <h6>Caratteristiche:</h6>
            <#if purchaseRequest.characteristics?? && purchaseRequest.characteristics?size gt 0>
                <ul>
                    <#list purchaseRequest.characteristics as requestCharacteristic>
                        <li><strong>${requestCharacteristic.characteristic.name}:</strong> ${requestCharacteristic.value}</li>
                    </#list>
                </ul>
            <#else>
                <p>Nessuna caratteristica disponibile</p>
            </#if>

            <h6>Note:</h6>
            <p>${purchaseRequest.notes!''}</p>
            
            <#if purchaseRequest.rejectionReason??>
                <h6>Motivazione rifiuto:</h6>
                <p>${purchaseRequest.rejectionReason!''}</p>
            </#if>

            <#if user.getUserType() == "Ordinante" && purchaseRequest.status == "PENDING">
                <a href="editPurchaseRequest?id=${purchaseRequest.id}" class="btn btn-warning">Modifica</a>
                <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">Elimina</button>
            </#if>
            <#if user.getUserType() == "Ordinante" && purchaseRequest.status == "IN_PROGRESS" && hasAcceptedProposal>
                <a href="closePurchaseRequest?id=${purchaseRequest.id}" class="btn btn-warning">Chiudi Richiesta</a>
            </#if>
        </div>
    </div>

    <a href="<#if user.getUserType() == "Ordinante">viewPurchaseRequests<#else>technicianRequests?action=viewPending</#if>" class="btn btn-secondary mt-3">Torna alla lista</a>
</div>

<#if user.getUserType() == "Ordinante" && purchaseRequest.status == "PENDING">
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Conferma Eliminazione</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Sei sicuro di voler eliminare questa richiesta di acquisto?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annulla</button>
                    <form action="deletePurchaseRequest" method="post">
                        <input type="hidden" name="id" value="${purchaseRequest.id}">
                        <button type="submit" class="btn btn-danger">Elimina</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</#if>

<#include "/footer.ftl.html">